import { Knex } from 'knex';

export async function up(knex: Knex): Promise<void> {
  await knex.schema.alterTable('refresh_tokens', (t) => {
    t.string('device_fingerprint', 255).nullable();
    t.specificType('ip_address', 'inet').nullable();
  });
  
  await knex.raw(`
    CREATE INDEX idx_refresh_tokens_cleanup 
    ON refresh_tokens(expires_at) 
    WHERE revoked_at IS NULL;
  `);
}