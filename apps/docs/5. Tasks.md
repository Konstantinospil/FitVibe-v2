# FitVibe Task Tracker

## 1) Project Foundation & Governance

- [x] P-1 Monorepo root + folders (`apps/`, `packages/`, `infra/`, `tests/`)
- [x] P-2 pnpm workspaces + (optional) Turborepo
- [x] P-3 CONTRIBUTING.md (branching, PR rules, semver)
- [x] P-4 SECURITY.md (key rotation, GDPR procedures)
- [x] P-5 ADR framework (`apps/docs/adr/` + template)
- [x] P-6 Glossary + docs index under `apps/docs/`
- [x] P-7 ADR <!-- PRD FR-8 vs TDD Section 14.2.3 -->

## 2) CI/CD & Dev Tooling

- [x] I-1 CI/CD stages defined in PRD (lint -> type -> test -> build -> Docker -> GHCR; health gate & rollback)
- [x] I-2 Implement `.github/workflows/ci.yml` (incl. Codecov)
- [x] I-3 Implement `.github/workflows/cd.yml` (manual approval, healthcheck, rollback)
- [x] I-4 Lighthouse CI (fail if < 90)
- [x] I-5 Security scans (npm-audit/Snyk) + CycloneDX SBOM
- [x] I-6 Ephemeral Postgres + seeds for CI
- [x] I-7 `.vscode/tasks.json` extended commands
- [x] I-8 Rollback scripts (`infra/scripts/rollback.sh`)
- [x] I-9 Metrics-contract gate: scrape `/metrics` and assert required histograms/counters + labels (route templates) in CI. <!-- PRD Sections 5.6 & 6.10.1 -->
- [x] I-10 Feature-flag defaults check: assert all non-MVP flags are disabled in prod/staging config. <!-- PRD Section 6.9.1 -->
- [x] I-11 Backend lint/format cleanup: prettier `--write` + eslint `--fix`, follow-up manual fixes, re-run lint.
- [x] I-12 Secrets manager integration for staging/prod (Vault or AWS Secrets Manager) + rotation automation. <!-- TDD Sections 10.6 & 13.7 -->
- [x] I-13 Container image signing & verification with `cosign` and pinned digest enforcement in CD. <!-- TDD Sections 10.5 & 9.3 -->
- [x] I-14 Wire up OpenAPI build (`pnpm openapi:build`) so CI can publish `apps/backend/openapi/openapi.json`. <!-- TDD Section 10.2.1 -->
- [x] I-15 Add staging auto-deploy workflow (main -> staging env with health gate + feature flag toggles). <!-- TDD Section 10.3.1 -->
- [x] I-16 Retire or align legacy `.github/workflows/cd-prod.yml` with pnpm-based deploy to avoid GitHub Actions failure. <!-- TDD Section 10.3 -->
- [x] I-17 Ensure SCA stack matches docs: OSV scan + Snyk run gated on secrets with non-empty condition. <!-- TDD Section 10.2.1 -->

## 3) Backend - Cross-Cutting

- [x] B-CC-1 App bootstrap + router mounts
- [x] B-CC-2 Error handler + error envelope
- [x] B-CC-3 Logger (pino/morgan) with PII redaction
- [x] B-CC-4 Helmet, CORS, rate-limit
- [x] B-CC-5 CSRF protection for state-changing routes
- [x] B-CC-6 `/health` endpoint
- [x] B-CC-7 `/metrics` (Prometheus) + histograms
- [x] B-CC-8 Audit logger (GDPR-safe) wired to key flows
- [x] B-CC-9 Read-only mode kill-switch + guarded mutating endpoints (toggle via config/feature flags). <!-- TDD Section 13.8 -->

## 4) Backend - Domain Modules

### 4.1 Authentication & Identity (FR-1)

- [x] B-AUTH-1 Registration + email verification endpoints with rate limits (`POST /auth/register`, `/auth/verify`) (TDD Section 4.1.1, Section 6.2.3)
- [x] B-AUTH-2 Login, refresh, logout flow with cookie storage and JWT rotation (`/auth/login`, `/auth/refresh`, `/auth/logout`) (TDD Section 4.1.2, Section 6.2.3)
- [x] B-AUTH-3 Password recovery (`/auth/password/forgot`, `/auth/password/reset`) respecting resend quotas and token TTL (TDD Section 4.1.3, Section 6.2.3)
- [x] B-AUTH-4 Auth session persistence + JWKS exposure (`/.well-known/jwks.json`) and audit hooks (TDD Section 6.2.3, Section 12.5)
- [x] B-AUTH-5 Session family reuse detection alarm -> revoke family + emit audit event.

### 4.2 Users & Profiles (FR-2)

- [x] B-USR-1 User CRUD + status transitions (pending -> active -> archived) with audit entries (TDD Section 4.2.1)
- [x] B-USR-2 Contact management (`email`, `phone`) and verification flags (TDD Section 6.2.5)
- [x] B-USR-3 Avatar upload + media linkage through storage abstraction (TDD Section 4.2.3, Section 6.5.2)
- [x] B-USR-4 GDPR delete/export endpoints tied to retention routines (PRD Section 5.2, TDD Section 12.6)
- [x] B-USR-5 Antivirus protection against malicious uploads (ClamAV integration with fail-closed production mode)
- [x] B-USR-6 DSR export bundle assembler (users, profile, exercises, sessions, points/badges, media metadata).
- [x] B-USR-7 DSR delete executor (cascades + tombstones, async purge, backup purge window ->14 days).

### 4.3 Exercise Library (FR-3)

- [x] B-EX-1 Admin seed + user-owned exercises with ownership rules and soft delete (PRD Section 4.3, TDD Section 4.3.2)
- [x] B-EX-2 Tagging/search endpoints backed by JSONB GIN index (TDD Section 6.2.7)
- [x] B-EX-3 Exercise type lookup APIs sourced from normalized tables (TDD Section 6.2.6)
- [x] B-EX-4 Global exercise admin seed pack (Squat/Bench/Deadlift/Run/Ride with categories & tags).

### 4.4 Planning & Sessions (FR-4)

- [x] B-SES-1 Session CRUD (`plan_id`, status transitions) with recurrence metadata (TDD Section 4.4.2, Section 6.2.9)
- [x] B-SES-2 Session exercise + attribute management (planned vs actual) including validation (TDD 4.4.3, 6.2.10-6.2.11)
- [x] B-SES-3 Clone/template + idempotent create behavior (TDD Section 4.4.4)
- [x] B-SES-4 Session summary refresh hooks / materialized view maintenance (TDD Section 6.7, Section 12.4)
- [x] B-SES-5 Recurrence templates API (clone with date offset & safeguards).

### 4.5 Progress & Analytics (FR-5)

- [x] B-PRG-1 Summary & trends endpoints using exercise set metrics (`/progress/summary`, `/progress/trends`) (TDD Section 4.5.1-4.5.2)
- [x] B-PRG-2 Exercise breakdown & plans progress endpoints with audit logging (TDD Section 4.5.3)
- [x] B-PRG-3 Export/report scaffolding aligned with QA analytics checks (PRD Section 5.3.5, QA Section 8.3)
- [x] B-PRG-4 Materialized views + refresh jobs (`session_summary`, `weekly_aggregates`; immediate refresh on completion).

### 4.6 Points & Badges (FR-6)

- [x] B-PTS-1 Points awarding service + history endpoints (`/points`, `/points/history`) (TDD Section 4.6.1-4.6.2)
- [x] B-PTS-2 Badge evaluation + awards persistence (TDD Section 4.6.3)
- [x] B-PTS-3 Background job hooks for streaks / seasonal events (PRD Section 4.6 backlog, TDD Section 12.8)
- [x] B-PTS-4 Seed badge catalog (First Session, 7-Day Streak, 10k Run, 100k Ride).

### 4.7 Feed & Sharing (FR-7)

- [x] B-FEED-1 Public feed listing with visibility rules (public/link/private) (TDD Section 4.7.1)
- [x] B-FEED-2 Clone/session share workflow with link tokens (TDD Section 4.7.2)
- [x] B-FEED-3 Followers/following management + uniqueness constraints (TDD Section 4.7.3)
- [x] B-FEED-4 Link-token revoke endpoint & audit (unguessable token, explicit revoke, visibility matrix).
- [x] B-FEED-5 Like/unlike endpoints with counts and rate limits (TDD Section 4.7.3, Section 4.7.5).
- [x] B-FEED-6 Session bookmark endpoints (`POST/DELETE /sessions/:id/bookmark`, `GET /users/me/bookmarks`) (TDD Section 4.7.3).
- [x] B-FEED-7 Comments CRUD with moderation hooks, keyword filtering, and rate limits (TDD Section 4.7.3, Section 4.7.5).
- [x] B-FEED-8 Leaderboards (global/friends weekly/monthly) + materialized view refresh job (TDD Section 4.7.3). <!-- operational refresh automation tracked separately under D-12 -->
- [x] B-FEED-9 User blocking and feed filtering to hide blocked users (TDD Section 4.7.4).
- [x] B-FEED-10 Abuse reporting and takedown workflow instrumentation (TDD Section 4.7.5).

### 4.8 Internationalization (FR-8)

- [x] B-I-1 `detectLanguage` middleware (removed - dynamic translation out of scope)
- [x] B-I-2 `translation.service` + provider adapter (removed - dynamic translation out of scope)
- [x] B-I-3 `translation_cache` table + TTL=7d (removed - dynamic translation out of scope)
- [x] B-I-4 PII redaction before translation API calls (removed - dynamic translation out of scope)
- [x] B-I-5 Integrate translations in `/feed` & `/sessions` (removed - dynamic translation out of scope)
  > Note: Until ADR P-7 is decided, ship with **FEATURE_DYNAMIC_TRANSLATION=false** in prod; static EN/DE tokens remain required. <!-- PRD FR-8; QA AC-8.3..8.5 -->

## 5) Database & Migrations

- [x] D-1 Core tables (users, sessions, exercises, points, media, etc.)
- [x] D-2 Lookup normalization + seeds
- [x] D-3 Soft-delete (`archived_at`)
- [x] D-4 Indices & FKs complete
- [x] D-5 Views for progress aggregates
- [x] D-6 Retention & purge scripts (GDPR)
- [x] D-7 Migration up/down tests scaffold
- [x] D-8 Monthly partitioning for `sessions` on `planned_at` + rotation/archival policy.
- [x] D-9 Retention job set (purge `idempotency_keys` 24h, tokens by TTL, DSR purges).
- [x] D-10 Audit log schema & indices (PII-safe fields; `ts,user_id,action,outcome` with hot queries covered).
- [x] D-11 Moderation/report tables (`reports`, `notifications`, takedown queue) to support feed abuse workflow (TDD Section 4.7, Section 6.3).
- [x] D-12 Leaderboard materialized views + refresh scheduler (weekly/monthly) (TDD Section 4.7.3).

## 6) Frontend (React SPA)

- [x] F-1 Vite + React scaffold
- [x] F-2 Routing (Login, Dashboard, Planner, Logger, Progress, Feed, Profile)
- [x] F-3 State (Zustand/Redux + React Query)
- [x] F-4 Axios client + 401 -> refresh
- [x] F-5 UI kit (Buttons, Cards, Avatar, Chart)
- [x] F-6 Typography system & brand tokens applied
- [x] F-7 i18next (EN/DE) dictionaries + switch
- [x] F-8 Accessibility (ARIA/keyboard/contrast)
- [x] F-9 Lighthouse >= 90 (LCP < 2.5 s)
- [x] F-10 Visibility badges & guards (clear "Private/Link/Public" indicators wherever content appears).
- [x] F-11 Share-link UI (create/revoke link tokens; copy-link; state reflects revocation).
- [x] F-12 Analytics dashboards (Summary, PRs, Weekly aggregates with range/grain controls; capped payload size).
- [x] F-13 i18n token coverage gate (EN/DE static catalogs; missing-key detector in CI).
- [x] F-14 Idempotent form decorator (attach `Idempotency-Key` for session mutations).
- [x] F-15 Runtime feature flag & kill-switch sync (fetch `/config`, hide analytics, surface read-only banner). <!-- TDD Sections 13.5 & 13.8 -->

## 7) Testing & QA Automation

- [ ] Q-1 QA Plan v2.0 baseline established
- [ ] Q-2 Unit/integration scaffolding (Jest + Supertest)
- [ ] Q-3 Contract tests (zod -> OpenAPI)
- [ ] Q-4 E2E Playwright (register -> login -> plan -> complete)
- [ ] Q-5 Accessibility tests (axe + Lighthouse CI)
- [ ] Q-6 Performance tests (k6; p95 < 300 ms)
- [ ] Q-7 Security scans (ZAP, Snyk, secret scans)
- [ ] Q-8 Coverage gate >= 80% (Codecov)
- [ ] Q-9 QA summary HTML + Grafana trend
- [ ] Q-10 Auth email/reset TTL & resend rules: verify 15-minute TTL, 3 resend/hour, and 7-day auto-purge for unverified accounts. <!-- PRD FR-1 -->
- [ ] Q-11 No user enumeration/timing budget: generic errors; variance <=10% vs valid user. <!-- PRD FR-1 -->
- [ ] Q-12 Perf regression guard: block on >10% p95 regression per grouped budgets; assert per-endpoint p95s. <!-- PRD Section 5.3 & QA Plan -->
- [ ] Q-13 DSR E2E (export bundle completeness + delete cascade + backup purge SLO).
- [ ] Q-14 EICAR upload test (reject malware; AV status surfaced).
- [ ] Q-15 Security-headers test (CSP/HSTS/Referrer/Permissions present with exact values).
- [ ] Q-16 Idempotency replay suite (same key -> same result; mismatched payload -> 409).
- [ ] Q-17 i18n static coverage (CI fails on missing EN/DE tokens).
- [ ] Q-18 Keyboard-only a11y flows for `/auth/*`, planner/logger, analytics.

## 8) Observability, Security & Ops (NFR)

- [ ] O-1 Structured logs (correlation IDs; PII redaction)
- [ ] O-2 Prometheus metrics + Grafana dashboards
- [ ] O-3 Loki log pipeline
- [ ] O-4 **Alert rules:** warn when p95 > 400 ms for 10 min; critical when error rate > 0.5% for 5 min; include DB pool saturation and auth-failure spikes. <!-- PRD Section 5.6.1 -->
- [ ] O-5 Backup & restore scripts + quarterly DR test
- [ ] O-6 JWT key rotation runbook + monitoring
- [ ] O-7 SLO dashboard (>= 99.5%)
- [ ] O-8 OTel dashboards (trace rate, slowest spans by route; sampling config).
- [ ] O-9 Auth anomaly alerts (brute-force spikes, refresh-reuse detections).
- [ ] O-10 AV scan failure alert & dashboard panel.

## 9) Documentation & Governance

- [x] D-OC-1 PRD v1.0 complete
- [x] D-OC-2 TDD v1.2 (backend MVP) complete
- [x] D-OC-3 QA Plan v2.0 complete
- [x] D-OC-4 ADRs for major decisions created
- [ ] D-OC-5 API reference auto-generation (OpenAPI)
- [x] D-OC-6 ERD export (Mermaid) from current schema
- [x] D-OC-7 PRD patch or ADR outcome: if ADR P-7 defers dynamic translation, update PRD to mark dynamic AI translation as Phase 2 and keep QA AC-8.3..8.5 behind flag; else, keep MVP scope and enable the flag on release. <!-- PRD FR-8 / QA AC-8.3..8.5 / TDD Section 14.2.3 -->
- [ ] D-OC-8 Privacy Policy + Data Map (link inside app; lawful basis per category).
- [ ] D-OC-9 Security headers & NGINX doc (edge config, OCSP stapling).
- [ ] D-OC-10 ADRs for idempotency policy, partitions, AV scanning (ensure they exist & are linked).
- [ ] D-OC-11 Sync TDD data schema with latest migrations (share links feed_item support, badge catalog, moderation tables).
