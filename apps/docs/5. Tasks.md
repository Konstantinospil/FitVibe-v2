# FitVibe Task Tracker

## 1) Project Foundation & Governance

- [x] P-1 Monorepo root + folders (`apps/`, `packages/`, `infra/`, `tests/`)
- [x] P-2 pnpm workspaces + (optional) Turborepo
- [x] P-3 CONTRIBUTING.md (branching, PR rules, semver)
- [x] P-4 SECURITY.md (key rotation, GDPR procedures)
- [x] P-5 ADR framework (`apps/docs/adr/` + template)
- [x] P-6 Glossary + docs index under `apps/docs/`
- [x] P-7 ADR <!-- PRD FR-8 vs TDD Section 14.2.3 -->

## 2) CI/CD & Dev Tooling

- [x] I-1 CI/CD stages defined in PRD (lint -> type -> test -> build -> Docker -> GHCR; health gate & rollback)
- [x] I-2 Implement `.github/workflows/ci.yml` (incl. Codecov)
- [x] I-3 Implement `.github/workflows/cd.yml` (manual approval, healthcheck, rollback)
- [x] I-4 Lighthouse CI (fail if < 90)
- [x] I-5 Security scans (npm-audit/Snyk) + CycloneDX SBOM
- [x] I-6 Ephemeral Postgres + seeds for CI
- [x] I-7 `.vscode/tasks.json` extended commands
- [x] I-8 Rollback scripts (`infra/scripts/rollback.sh`)
- [x] I-9 Metrics-contract gate: scrape `/metrics` and assert required histograms/counters + labels (route templates) in CI. <!-- PRD Sections 5.6 & 6.10.1 -->
- [x] I-10 Feature-flag defaults check: assert all non-MVP flags are disabled in prod/staging config. <!-- PRD Section 6.9.1 -->
- [ ] I-11 Backend lint/format cleanup: prettier `--write` + eslint `--fix`, follow-up manual fixes, re-run lint.

## 3) Backend â€“ Cross-Cutting

- [x] B-CC-1 App bootstrap + router mounts
- [x] B-CC-2 Error handler + error envelope
- [x] B-CC-3 Logger (pino/morgan) with PII redaction
- [x] B-CC-4 Helmet, CORS, rate-limit
- [x] B-CC-5 CSRF protection for state-changing routes
- [x] B-CC-6 `/health` endpoint
- [x] B-CC-7 `/metrics` (Prometheus) + histograms
- [x] B-CC-8 Audit logger (GDPR-safe) wired to key flows

## 4) Backend - Domain Modules

### 4.1 Authentication & Identity (FR-1)

- [x] B-AUTH-1 Registration + email verification endpoints with rate limits (`POST /auth/register`, `/auth/verify`) (TDD Â§4.1.1, Â§6.2.3)
- [x] B-AUTH-2 Login, refresh, logout flow with cookie storage and JWT rotation (`/auth/login`, `/auth/refresh`, `/auth/logout`) (TDD Â§4.1.2, Â§6.2.3)
- [x] B-AUTH-3 Password recovery (`/auth/password/forgot`, `/auth/password/reset`) respecting resend quotas and token TTL (TDD Â§4.1.3, Â§6.2.3)
- [x] B-AUTH-4 Auth session persistence + JWKS exposure (`/.well-known/jwks.json`) and audit hooks (TDD Â§6.2.3, Â§12.5)
- [ ] B-AUTH-5 Session family reuse detection alarm â†’ revoke family + emit audit event.

### 4.2 Users & Profiles (FR-2)

- [x] B-USR-1 User CRUD + status transitions (pending â†’ active â†’ archived) with audit entries (TDD Â§4.2.1)
- [x] B-USR-2 Contact management (`email`, `phone`) and verification flags (TDD Â§6.2.5)
- [x] B-USR-3 Avatar upload + media linkage through storage abstraction (TDD Â§4.2.3, Â§6.5.2)
- [x] B-USR-4 GDPR delete/export endpoints tied to retention routines (PRD Â§5.2, TDD Â§12.6)
- [ ] B-USR-5 Antivirus protection against malicious uploads
- [ ] B-USR-6 DSR export bundle assembler (users, profile, exercises, sessions, points/badges, media metadata).
- [ ] B-USR-7 DSR delete executor (cascades + tombstones, async purge, backup purge window â‰¤14 days).

### 4.3 Exercise Library (FR-3)

- [x] B-EX-1 Admin seed + user-owned exercises with ownership rules and soft delete (PRD Â§4.3, TDD Â§4.3.2)
- [x] B-EX-2 Tagging/search endpoints backed by JSONB GIN index (TDD Â§6.2.7)
- [x] B-EX-3 Exercise type lookup APIs sourced from normalized tables (TDD Â§6.2.6)
- [ ] B-EX-4 Global exercise admin seed pack (Squat/Bench/Deadlift/Run/Ride with categories & tags).

### 4.4 Planning & Sessions (FR-4)

- [x] B-SES-1 Session CRUD (`plan_id`, status transitions) with recurrence metadata (TDD Â§4.4.2, Â§6.2.9)
- [x] B-SES-2 Session exercise + attribute management (planned vs actual) including validation (TDD 4.4.3, 6.2.10-6.2.11)
- [x] B-SES-3 Clone/template + idempotent create behavior (TDD Â§4.4.4)
- [x] B-SES-4 Session summary refresh hooks / materialized view maintenance (TDD Â§6.7, Â§12.4)
- [x] B-SES-5 Recurrence templates API (clone with date offset & safeguards).

### 4.5 Progress & Analytics (FR-5)

- [ ] B-PRG-1 Summary & trends endpoints using exercise set metrics (`/progress/summary`, `/progress/trends`) (TDD Â§4.5.1â€“4.5.2)
- [ ] B-PRG-2 Exercise breakdown & plans progress endpoints with audit logging (TDD Â§4.5.3)
- [ ] B-PRG-3 Export/report scaffolding aligned with QA analytics checks (PRD Â§5.3.5, QA Â§8.3)
- [ ] B-PRG-4 Materialized views + refresh jobs (`session_summary`, `weekly_aggregates`; immediate refresh on completion).

### 4.6 Points & Badges (FR-6)

- [ ] B-PTS-1 Points awarding service + history endpoints (`/points`, `/points/history`) (TDD Â§4.6.1â€“4.6.2)
- [ ] B-PTS-2 Badge evaluation + awards persistence (TDD Â§4.6.3)
- [ ] B-PTS-3 Background job hooks for streaks / seasonal events (PRD Â§4.6 backlog, TDD Â§12.8)
- [ ] B-PTS-4 Seed badge catalog (First Session, 7-Day Streak, 10k Run, 100k Ride).

### 4.7 Feed & Sharing (FR-7)

- [ ] B-FEED-1 Public feed listing with visibility rules (public/link/private) (TDD Â§4.7.1)
- [ ] B-FEED-2 Clone/session share workflow with link tokens (TDD Â§4.7.2)
- [ ] B-FEED-3 Followers/following management + uniqueness constraints (TDD Â§4.7.3)
- [ ] B-FEED-4 Link-token revoke endpoint & audit (unguessable token, explicit revoke, visibility matrix).

### 4.8 Internationalization (FR-8)

- [ ] B-I-1 `detectLanguage` middleware (TDD Â§6.14.2)
- [ ] B-I-2 `translation.service` + provider adapter (OpenAI/DeepL) **(behind FEATURE_DYNAMIC_TRANSLATION)**
- [ ] B-I-3 `translation_cache` table + TTL=7d **(behind FEATURE_DYNAMIC_TRANSLATION)**
- [ ] B-I-4 PII redaction before translation API calls **(behind FEATURE_DYNAMIC_TRANSLATION)**
- [ ] B-I-5 Integrate translations in `/feed` & `/sessions` **(behind FEATURE_DYNAMIC_TRANSLATION)**
  > Note: Until ADR P-7 is decided, ship with **FEATURE_DYNAMIC_TRANSLATION=false** in prod; static EN/DE tokens remain required. <!-- PRD FR-8; QA AC-8.3..8.5 -->

## 5) Database & Migrations

- [x] D-1 Core tables (users, sessions, exercises, points, media, etc.)
- [x] D-2 Lookup normalization + seeds
- [ ] D-3 Soft-delete (`archived_at`)
- [ ] D-4 Indices & FKs complete
- [ ] D-5 Views for progress aggregates
- [ ] D-6 Retention & purge scripts (GDPR)
- [ ] D-7 Migration up/down tests scaffold
- [ ] D-8 Monthly partitioning for `sessions` on `planned_at` + rotation/archival policy.
- [ ] D-9 Retention job set (purge `idempotency_keys` 24h, tokens by TTL, DSR purges).
- [ ] D-10 Audit log schema & indices (PII-safe fields; `ts,user_id,action,outcome` with hot queries covered).

## 6) Frontend (React SPA)

- [x] F-1 Vite + React scaffold
- [ ] F-2 Routing (Login, Dashboard, Planner, Logger, Progress, Feed, Profile)
- [ ] F-3 State (Zustand/Redux + React Query)
- [ ] F-4 Axios client + 401 -> refresh
- [ ] F-5 UI kit (Buttons, Cards, Avatar, Chart)
- [ ] F-6 Typography system & brand tokens applied
- [ ] F-7 i18next (EN/DE) dictionaries + switch
- [ ] F-8 Accessibility (ARIA/keyboard/contrast)
- [ ] F-9 Lighthouse >= 90 (LCP < 2.5 s)
- [ ] F-10 Visibility badges & guards (clear â€œPrivate/Link/Publicâ€ indicators wherever content appears).
- [ ] F-11 Share-link UI (create/revoke link tokens; copy-link; state reflects revocation).
- [ ] F-12 Analytics dashboards (Summary, PRs, Weekly aggregates with range/grain controls; capped payload size).
- [ ] F-13 i18n token coverage gate (EN/DE static catalogs; missing-key detector in CI).
- [ ] F-14 Idempotent form decorator (attach `Idempotency-Key` for session mutations).

## 7) Testing & QA Automation

- [ ] Q-1 QA Plan v2.0 baseline established
- [ ] Q-2 Unit/integration scaffolding (Jest + Supertest)
- [ ] Q-3 Contract tests (zod -> OpenAPI)
- [ ] Q-4 E2E Playwright (register -> login -> plan -> complete)
- [ ] Q-5 Accessibility tests (axe + Lighthouse CI)
- [ ] Q-6 Performance tests (k6; p95 < 300 ms)
- [ ] Q-7 Security scans (ZAP, Snyk, secret scans)
- [ ] Q-8 Coverage gate >= 80% (Codecov)
- [ ] Q-9 QA summary HTML + Grafana trend
- [ ] Q-10 Auth email/reset TTL & resend rules: verify 15-minute TTL, 3 resend/hour, and 7-day auto-purge for unverified accounts. <!-- PRD FR-1 -->
- [ ] Q-11 No user enumeration/timing budget: generic errors; variance <=10% vs valid user. <!-- PRD FR-1 -->
- [ ] Q-12 Perf regression guard: block on >10% p95 regression per grouped budgets; assert per-endpoint p95s. <!-- PRD Section 5.3 & QA Plan -->
- [ ] Q-13 DSR E2E (export bundle completeness + delete cascade + backup purge SLO).
- [ ] Q-14 EICAR upload test (reject malware; AV status surfaced).
- [ ] Q-15 Security-headers test (CSP/HSTS/Referrer/Permissions present with exact values).
- [ ] Q-16 Idempotency replay suite (same key â†’ same result; mismatched payload â†’ 409).
- [ ] Q-17 i18n static coverage (CI fails on missing EN/DE tokens).
- [ ] Q-18 Keyboard-only a11y flows for `/auth/*`, planner/logger, analytics.

## 8) Observability, Security & Ops (NFR)

- [ ] O-1 Structured logs (correlation IDs; PII redaction)
- [ ] O-2 Prometheus metrics + Grafana dashboards
- [ ] O-3 Loki log pipeline
- [ ] O-4 **Alert rules:** warn when p95 > 400 ms for 10 min; critical when error rate > 0.5% for 5 min; include DB pool saturation and auth-failure spikes. <!-- PRD Section 5.6.1 -->
- [ ] O-5 Backup & restore scripts + quarterly DR test
- [ ] O-6 JWT key rotation runbook + monitoring
- [ ] O-7 SLO dashboard (>= 99.5%)
- [ ] O-8 OTel dashboards (trace rate, slowest spans by route; sampling config).
- [ ] O-9 Auth anomaly alerts (brute-force spikes, refresh-reuse detections).
- [ ] O-10 AV scan failure alert & dashboard panel.

## 9) Documentation & Governance

- [x] D-OC-1 PRD v1.0 complete
- [x] D-OC-2 TDD v1.2 (backend MVP) complete
- [x] D-OC-3 QA Plan v2.0 complete
- [x] D-OC-4 ADRs for major decisions created
- [ ] D-OC-5 API reference auto-generation (OpenAPI)
- [x] D-OC-6 ERD export (Mermaid) from current schema
- [x] D-OC-7 PRD patch or ADR outcome: if ADR P-7 defers dynamic translation, update PRD to mark dynamic AI translation as Phase 2 and keep QA AC-8.3..8.5 behind flag; else, keep MVP scope and enable the flag on release. <!-- PRD FR-8 / QA AC-8.3..8.5 / TDD Section 14.2.3 -->
- [ ] D-OC-8 Privacy Policy + Data Map (link inside app; lawful basis per category).
- [ ] D-OC-9 Security headers & NGINX doc (edge config, OCSP stapling).
- [ ] D-OC-10 ADRs for idempotency policy, partitions, AV scanning (ensure they exist & are linked).
