---
title: "FitVibe — Testing & Quality Assurance Plan"
version: "v3.0"
status: "Approved (MVP → GA baseline)"
review_cadence: "Per release and quarterly"
date: "2025-10-26"
license: "MIT"
---

# Appendix B — Acceptance Criteria (excerpt skeleton)

## Legend

- **Verif.** = Verification methods (Unit / Integration / Contract / E2E / Perf / A11y / Security / Visual / DB / Compliance / Ops).
- **Evidence** = Expected CI or release artifacts.
- **Gate** = Concrete pass/fail threshold (blocks merge/release if unmet).

---

## FR-1 — User Management & Security

| AC ID       | Criterion                                                                                                        | Verif.                               | Evidence                                      | Gate                               |
| ----------- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------ | --------------------------------------------- | ---------------------------------- |
| **AC-1.1**  | Email verification required pre-login; token TTL **15 min**; resend ≤ **3/hour**; unverified purged ≤ **7 days** | Integration, E2E                     | API test logs; Playwright trace; audit record | All subchecks pass                 |
| **AC-1.2**  | Account lockout after **10** failed logins; unlock requires CAPTCHA or cooldown                                  | Integration                          | Test report; rate-limit logs                  | Lockout triggered exactly at 10    |
| **AC-1.3**  | Password policy ≥ **12 chars** w/ upper/lower/number/symbol                                                      | Unit, Integration                    | Validator unit tests                          | 100% policy cases pass             |
| **AC-1.4**  | DSR export & delete processed ≤ **30 days**                                                                      | E2E, Compliance                      | DSR ticket + timestamped audit bundle         | SLA ≤ 30d                          |
| **AC-1.5**  | 2FA (TOTP) enrollment requires current password; generates **10** backup codes                                   | Integration, E2E                     | Enrollment log + codes                        | Codes unique; stored hashed        |
| **AC-1.6**  | If 2FA enabled, login requires valid TOTP or single-use backup code (burn on use)                                | E2E                                  | Playwright trace                              | Backup code cannot be reused       |
| **AC-1.7**  | Admin endpoints require `role=admin`; **no IDOR** across resources                                               | Security (ZAP auth ctx), Integration | ZAP report; 403 assertions                    | 0 High in ZAP; all RBAC tests pass |
| **AC-1.8**  | Verify-email resend throttled **≤3/hour** per acct/IP; auto-purge unverified at 7d                               | Integration, Ops                     | Job log; throttle counters                    | Throttle hit at 4th request        |
| **AC-1.9**  | Password reset token single-use; **15 min** TTL; success revokes **all** refresh tokens                          | Security, Integration                | Token table diff; 401 on old tokens           | Reuse denied; sessions revoked     |
| **AC-1.10** | Refresh rotation; **reuse detection → family revoke**; explicit logout clears sessions                           | Integration, Security                | DB token audit; negative reuse test           | Reuse returns 401 + revoke         |
| **AC-1.11** | JWKS/key rotation: current + previous keys valid during grace window                                             | Integration, Ops                     | JWKS fetch tests                              | Both keys validate within window   |
| **AC-1.12** | **No user enumeration**; timing variance **≤10%** vs valid user                                                  | Security (timing), Integration       | Timing diff report                            | ≤10% relative variance             |

---

## FR-2 — Profile & Settings

| AC ID      | Criterion                                                         | Verif.                | Evidence                     | Gate                            |
| ---------- | ----------------------------------------------------------------- | --------------------- | ---------------------------- | ------------------------------- |
| **AC-2.1** | Alias unique (case-insensitive)                                   | Integration           | Conflict test                | 409 on dup (any case)           |
| **AC-2.2** | Avatar ≤ **5 MB** (JPEG/PNG/WebP); renders in UI; EXIF stripped   | E2E, Security         | Upload logs; UI render check | Size/type enforced; EXIF absent |
| **AC-2.3** | Profile updates create snapshot rows in `user_state_history`      | Integration, DB       | DB diff                      | ≥1 snapshot per update          |
| **AC-2.4** | `dateOfBirth`, `gender` immutable post-creation → **422**         | Contract, Integration | API contract test            | Attempts rejected w/ 422        |
| **AC-2.5** | All uploads AV-scanned; **EICAR** rejected (HTTP **400** + audit) | Security, Integration | AV log; audit entry          | EICAR blocked                   |

---

## FR-3 — Exercise Library

| AC ID      | Criterion                                                                           | Verif.                | Evidence                    | Gate                             |
| ---------- | ----------------------------------------------------------------------------------- | --------------------- | --------------------------- | -------------------------------- |
| **AC-3.1** | Delete = soft-delete; records remain auditable                                      | Integration, DB       | DB flags; API behavior      | Not visible in lists; kept in DB |
| **AC-3.2** | Public flag controls discoverability in feed/search                                 | E2E, Integration      | Feed query checks           | Public visible; private hidden   |
| **AC-3.3** | Exercise name snapshot retained in `session_exercises`                              | DB                    | DB row contents             | Snapshot equals at creation time |
| **AC-3.4** | Global library RBAC: only admins can create/update/delete global items; audit trail | Security, Integration | ZAP auth ctx; audit entries | All admin checks pass; audit ok  |

---

## FR-4 — Sessions (Plan / Log / Clone)

| AC ID      | Criterion                                                        | Verif.            | Evidence                | Gate                           |
| ---------- | ---------------------------------------------------------------- | ----------------- | ----------------------- | ------------------------------ |
| **AC-4.1** | Timestamps are timezone-safe; DST transitions correct            | Unit, Integration | Fixture across DST      | Expected wall-time preserved   |
| **AC-4.2** | Planned vs Actual comparison visible in session UI               | E2E               | UI assertion            | Elements present & correct     |
| **AC-4.3** | Cloned session preserves attribution to original                 | E2E               | Attribution field check | Attribution non-null & matches |
| **AC-4.4** | RRULE expansion DST-safe across TZ                               | Unit, Integration | RRULE test suite        | Recurrences match spec         |
| **AC-4.5** | Cancelled instances excluded from streaks/points                 | Integration, E2E  | Points/streak calc      | Excluded consistently          |
| **AC-4.6** | Public→Private switch removes items from feed/search ≤ **5 min** | E2E, Security     | Poll logs; indexer log  | Removed within 5 minutes       |

---

## FR-5 — Progress & Analytics

| AC ID      | Criterion                                           | Verif.      | Evidence               | Gate                          |
| ---------- | --------------------------------------------------- | ----------- | ---------------------- | ----------------------------- |
| **AC-5.1** | Aggregations (date/category) are accurate           | Unit        | Deterministic fixtures | All totals match              |
| **AC-5.2** | Personal bests & streaks correct on seeded data     | Integration | Seed suite report      | PB/streaks exact              |
| **AC-5.3** | Exports: CSV/JSON valid (encoding, headers, values) | E2E         | File schema checks     | Valid CSV/JSON; sizes bounded |

---

## FR-6 — Points System

| AC ID      | Criterion                                        | Verif.                | Evidence              | Gate                       |
| ---------- | ------------------------------------------------ | --------------------- | --------------------- | -------------------------- |
| **AC-6.1** | Points auto-awarded on `session.complete()`      | Integration           | Event → points link   | Event triggers points once |
| **AC-6.2** | Scoring produces **non-negative bounded** values | Unit, Contract        | Boundary tests        | Never <0; never > max      |
| **AC-6.3** | Anti-gaming signals logged when thresholds trip  | Perf, Security        | Abuse scenario logs   | Signals created ≥1         |
| **AC-6.4** | API/UI never expose scoring internals            | Contract, E2E         | OpenAPI diff; UI scan | Only final score exposed   |
| **AC-6.5** | Admin adjustments audit: actor, reason, ts, diff | Security, Integration | Audit table rows      | All fields non-null        |

---

## FR-7 — Sharing & Community

| AC ID      | Criterion                                      | Verif.            | Evidence         | Gate                |
| ---------- | ---------------------------------------------- | ----------------- | ---------------- | ------------------- |
| **AC-7.1** | Default privacy = **private** for all sessions | Unit, Integration | Default check    | Private by default  |
| **AC-7.2** | Public feed paginated & searchable             | Integration       | Pagination tests | Bounds respected    |
| **AC-7.3** | Clone includes attribution metadata in feed    | E2E               | Feed item assert | Attribution visible |

---

## FR-8 — Internationalization (i18n)

| AC ID      | Criterion                                                                   | Verif.            | Evidence                  | Gate                     |
| ---------- | --------------------------------------------------------------------------- | ----------------- | ------------------------- | ------------------------ |
| **AC-8.1** | Language auto-detected from browser/profile                                 | Unit              | Resolver tests            | Correct lang chosen      |
| **AC-8.2** | Manual lang switch persists across sessions                                 | E2E               | LocalStorage/cookie check | Persisted after reload   |
| **AC-8.3** | All UI strings from **static catalogs (EN/DE)**; **no runtime translation** | Unit, Integration | Token coverage            | 100% tokens used         |
| **AC-8.4** | No **untranslated keys**; **fallback = EN**; lint forbids stray literals    | Static, Unit      | Lint/scan report          | 0 missing; 0 literals    |
| **AC-8.5** | DSR delete purges translation caches                                        | Integration, Ops  | Cache logs                | Purged within job window |

---

# Non-Functional Acceptance Criteria (Complete)

## Security & Privacy

| AC ID            | Criterion                                                                                                                              | Verif.                      | Evidence              | Gate                        |
| ---------------- | -------------------------------------------------------------------------------------------------------------------------------------- | --------------------------- | --------------------- | --------------------------- |
| **SEC-HEADERS**  | Security headers: **CSP** forbids `unsafe-inline`; cookies `HttpOnly; Secure; SameSite=Lax`; HSTS, Referrer-Policy, Permissions-Policy | Security (ZAP), Integration | ZAP HTML; header test | 0 High; all headers present |
| **SEC-ZAP**      | OWASP ZAP baseline (authenticated) → **no High** findings                                                                              | Security                    | ZAP HTML              | 0 High                      |
| **SEC-TLS**      | TLS 1.3 negotiated; OCSP stapling enabled at edge                                                                                      | Security, Ops               | SSL scan report       | Pass                        |
| **SEC-UPLOAD**   | AV scan blocks **EICAR**; audit entry created                                                                                          | Security, Integration       | AV log, 400 response  | Blocked with audit          |
| **PRIV-CONSENT** | Consent gating: no non-essential analytics before opt-in; events include `consent=true` after opt-in                                   | E2E (network)               | Request capture       | No events pre-opt-in        |
| **GDPR-DSR**     | DSR export/delete SLA **≤30 days**; evidence bundle archived                                                                           | Compliance                  | DSR bundle            | SLA met                     |
| **GDPR-BACKUP**  | Delete propagates to backups **≤14 days** proved by **erasure-replay**                                                                 | DR, Compliance              | DR log + query suite  | ≤14d propagation            |

## Performance & Web Perf

| AC ID         | Criterion                                                                                             | Verif.            | Evidence           | Gate                  |
| ------------- | ----------------------------------------------------------------------------------------------------- | ----------------- | ------------------ | --------------------- |
| **PERF-P95**  | Endpoint group budgets: auth ≤**200ms**, CRUD ≤**300ms**, feed ≤**400ms**, analytics ≤**600ms** (p95) | Perf (k6)         | k6 JSON            | All budgets met       |
| **PERF-REG**  | Regression guard blocks if p95 degrades **>10%** vs baseline                                          | Perf (k6)         | Guard report       | Δp95 ≤ 10%            |
| **WEB-LCP**   | LCP P75 < **2.5 s** on mid-tier 4G                                                                    | A11y/Perf         | Lighthouse JSON    | Score/budget pass     |
| **WEB-CALLS** | ≤ **5** API calls on first paint for key routes                                                       | E2E, Perf         | Network assertions | ≤5 on tracked screens |
| **RESP-SIZE** | Response size ≤ **1 MB**; gzip/Brotli for >1 KB payloads                                              | Integration, Perf | Size/budget report | All pass              |

## Accessibility & Visual Design

| AC ID             | Criterion                                                                                                                        | Verif.              | Evidence             | Gate                 |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------------- | ------------------- | -------------------- | -------------------- |
| **A11Y-CORE**     | WCAG 2.1 AA; axe/Lighthouse **≥90** on tracked pages                                                                             | A11y, Manual        | axe/lh JSON          | ≥90 on all pages     |
| **VIZ-TOK-03**    | Design tokens contract (CSS vars, spacing, typography, radii)                                                                    | Visual, Static      | Token check JSON     | 100% required tokens |
| **VIZ-SNAP-02**   | Visual regression for **Auth/Planner/Logger/Dashboard** across **light/dark** and **xs/sm/md/lg**; **diff ≤0.2%**; mask dynamics | Visual (Playwright) | Diff images + report | ≤0.2% per screen     |
| **VIZ-RESP-05**   | No horizontal overflow; grids align; long-DE strings don’t break layout                                                          | Visual, A11y        | Responsive report    | All checks pass      |
| **VIZ-MOTION-09** | Honors `prefers-reduced-motion`; no info conveyed solely by animation                                                            | Visual, A11y        | Motion report        | Pass                 |

## Observability & Reliability

| AC ID         | Criterion                                                                | Verif.        | Evidence         | Gate                        |
| ------------- | ------------------------------------------------------------------------ | ------------- | ---------------- | --------------------------- |
| **OBS-HTTP**  | `/metrics` exposes HTTP histogram w/ labels `{method,route,status_code}` | Observability | Scrape test JSON | All required series present |
| **OBS-DB**    | `db_query_duration_ms` histogram exported                                | Observability | Scrape test JSON | Present with buckets        |
| **OBS-RUM**   | RUM gauge `frontend_lcp_ms` exported and scraped                         | Observability | Scrape test JSON | Present; P75 tracked        |
| **AVAIL-SLO** | Availability SLO **≥99.5%** monthly (error budget ≤0.5%)                 | Ops           | SLO dashboard    | SLO met                     |

## Contract, Data & DB

| AC ID            | Criterion                                                                      | Verif.       | Evidence              | Gate             |
| ---------------- | ------------------------------------------------------------------------------ | ------------ | --------------------- | ---------------- |
| **CNTR-OPENAPI** | zod ↔ OpenAPI bidirectional parity; negative assertions (no sensitive fields) | Contract     | OpenAPI parity report | 0 mismatches     |
| **DB-CONTRACTS** | Required indexes exist; migrations monotonic; schema drift = 0                 | DB, Contract | DB contract HTML      | All checks green |

## Supply Chain & Packaging

| AC ID         | Criterion                                               | Verif.       | Evidence      | Gate                   |
| ------------- | ------------------------------------------------------- | ------------ | ------------- | ---------------------- |
| **SC-SBOM**   | SBOM generated per build; artifact archived             | Supply chain | SBOM JSON     | Present per build      |
| **SC-SIGN**   | Container images **cosign signed** & **verified** in CI | Supply chain | Verify logs   | Verified before deploy |
| **SC-DIGEST** | Deploys use **pinned sha256** digests (no mutable tags) | Supply chain | Manifest diff | Only digests allowed   |

## Backup & Disaster Recovery

| AC ID          | Criterion                                                        | Verif.         | Evidence             | Gate               |
| -------------- | ---------------------------------------------------------------- | -------------- | -------------------- | ------------------ |
| **DR-RPO**     | **RPO ≤ 24h** validated in quarterly restore drill               | DR             | Restore report       | ≤24h data currency |
| **DR-RTO**     | **RTO ≤ 4h** validated in quarterly restore drill                | DR             | Timing logs          | ≤4h restore time   |
| **DR-ERASURE** | **Erasure-replay** proves delete propagation to backups ≤14 days | DR, Compliance | Replay logs; queries | ≤14d confirmed     |

---

## Packaging & Usage

- Save as `docs/qa/acceptance_criteria.md` and reference from the RTM.
- Every AC ID must appear in RTM with tests, evidence, owner, status, last_run.
- CI must fail if any AC lacks passing tests/evidence or violates its Gate.

---
