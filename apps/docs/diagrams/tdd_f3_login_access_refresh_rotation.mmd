%% Source: TDD | Section: n/a | Heading: F3. Login + Access/Refresh Rotation
sequenceDiagram
  autonumber
  participant FE as Frontend
  participant API as /auth/login
  participant SVC as Auth Service
  participant DB as PostgreSQL

  FE->>API: POST /auth/login {username,email,password}
  API->>SVC: 'login()'
  SVC->>DB: verify hash, create refresh: jti, expires
  SVC-->>API: accessJWT:â‰¤15m, refreshCookie
  API-->>FE: Set_Cookie: access, refresh

  FE->>API: GET /protected
  API-->>FE: 200 OK

  Note over FE,API: Access expires
  FE->>API: POST /auth/refresh : cookie
  API->>SVC: rotateRefresh: jti
  SVC->>DB: revoke old, create new, issue new access
  API-->>FE: Set-Cookie: new access, new refresh
