---
title: "FitVibe Product Requirements Document (PRD)"
version: "v2.0"
status: "Accepted"
owner: "Konstantinos Pilpilidis (Dr.)"
date: "2025-10-21"
license: "MIT"
---

## 0.1 Purpose & Scope

This PRD specifies **which** features the FitVibe system entails.

## 0.2 Audience & Reading Guide

- **Engineers** implement according to specs, contracts, and runbooks.
- **QA** uses RTM links to derive tests and quality gates.
- **Security/Compliance** verifies controls, data classification, GDPR flows.
- **Product/Design** confirms that behavior matches PRD intent.

# 1. Vision

> **Editor’s note (SSOT):** Detailed **technology** and **CI/CD** mechanics have moved to the **Technical Design Document (TDD)**.
> In this PRD, §6 and §11.2/§11.3 are placeholders that point to TDD. Functional _what/why_ content remains here.

FitVibe is a platform, where users can upload and plan training sessions expanding over all domains of fitness (vibes). Each vibe is represented as an element and users are challenged to maintain a balance of the elements by training holistically over all vibes.

| Vibe         | Element | Activities                                          |
| ------------ | ------- | --------------------------------------------------- |
| Strength     | Earth   | Lifting, strongman, body building                   |
| Agility      | Air     | Juggling, climbing, bouldering, gymnastics, parkour |
| Endurance    | Water   | Running, hiking, cycling, rowing, jump rope         |
| Explosivity  | Fire    | Sprints, jumps, throws                              |
| Inteligence  | Shadow  | Chess, shooting, sailing                            |
| Regeneration | Aether  | Yoga, Stretching, Fasting                           |

### 1.1 Goals

The plattform enables individuals to **plan, log, share, and track** their training sessions with a clear, accessible, and responsive interface independent of their fitness activity. Further, the logic gives them the ability to log exercises and make them comparable.

### 1.2 Tech Vision

The system is designed with a **modular, scalable architecture** and strict **separation of concerns**, ensuring sustainable growth and easy extensibility (e.g., nutrition tracking, wearables integration, AI recommendations).

The system shall follow a **security-first design** and guarantee full **GDPR compliance**, including privacy-by-default settings and user-controlled data management.
Accessibility shall be central, following **WCAG 2.1 AA standards**, providing a barrier-free experience across devices and user groups.

---

## 2. Context, Scope, and Goals

### 2.1 Goals

The system shall:

- Provide an **easy-to-use interface** for planning and logging training sessions.
- Enable **fast entry and retrieval** of exercises and sessions.
- Facilitate **sharing and community engagement** with robust privacy controls.
- Offer **progress tracking** with historical data and analytics.
- Deliver a **gamified experience** via a hidden points system.
- Ensure an **accessible and responsive UI** (WCAG 2.1 AA).
- Guarantee **security-first user management** (2FA, brute-force protection, password policy).
- Support **scalability and modularity** for future enhancements.

### 2.2 Scope

#### 2.2.1 In Scope

- User
  - **User**: User accounts, profiles, and secure authentication.
  - **Personal Exercise library**: Every authenticated user can create and manage their own custom exercises.
  - **Global Exercise library**: Admins can still edit or delete system-wide (shared) exercises, but users can add personal ones that appear only in their own planner/logger.
  - **Planner**: Planning and logging sessions, as series of exercises done one-after-the-other.
  - **Progress Tracking**: Progress dashboard (history and charts).
  - **Gamification**: Points and badges awarded upon session completion and leaderboards.
  - **Social**: Public feed of sessions with privacy controls.
    - likes, bookmarks, comments.
    - Follow users (follow/unfollow UI, follower counts).
    - Leaderboards (global/friends).
  - **Adaptive Training suggestions**: AI-driven recommendations.
- Customizing
  - **Multilanguage**: English (**en**) and German (**de**) static translations for all UI and system text.
  - **Localization**: Locale-aware date, number, and unit formatting.
- Easy of administration
  - Admin dashboards for moderation.
  - Admin moderation (report queue, suspensions, takedowns).

#### 2.2.2 Out of Scope

- Third-party integrations (Garmin/Strava).
- Nutrition tracking and body composition analytics.
- Real-time chat
- Native mobile apps (progressive web app acceptable for MVP).
- Manual translation workflows or in-app translation editing.
- Voice or speech translation.
- RTL (right-to-left) language support.

---

## 3. Users and Use Cases

### 3.1 Personas

- [Athlete](.\4.personas\persona-member-athlete.md)
- [Follower](.\4.personas\persona-follower.md)
- [Coach](.\4.personas\persona-coach-trainer.md)
- [Administrator](.\4.personas\persona-administrator.md)
- [Content Curatoer](.\4.personas\persona-content-curator.md)

### 3.2 Core Use Cases

The system shall enable users to:

1. **Plan a session** with exercises and attributes for self or othere; save as draft or scheduled.
2. **Log a session**; record actual performance; mark complete; receive points based on ad hoc or predefined sessions and exercises.
3. **Browse the feed**; view or clone public sessions into the planner.
4. **Manage accounts**; edit profile, avatar, and security settings; export or delete data.
5. **Administer the platform**; configure selectable lists, review reports, moderate community content.

---

## 4. Functional Requirements (FR)

> Each FR includes **Acceptance Criteria (AC)** and, where relevant, **Error Behaviors (EB)**.

#### FR-1 User Management & Security

- **Registration** with verified email (15-minute TTL token, 3 resend/hour, auto-purge in 7 days).
  - **AC:** Duplicate usernames rejected (case-insensitive).
- **Login** with username/password; optional 2FA (TOTP + backup codes).
  - **EB:** Generic error messages, no user enumeration.
- **Password policy:** ≥12 chars, must include upper, lower, number, symbol.
- **Brute force protection:** max 10 failed attempts → exponential backoff, lock, optional CAPTCHA, user notified.
- **Logout** invalidates refresh session (rotated per use, revoked by `jti`).
- **Password reset** via single-use link (15 min TTL, audit logged).
- **Account deletion (GDPR):** hard deletion within 30 days (with exceptions for audit/legal); queued deletion from backups.
- **Data export:** JSON of profile, sessions, exercises, points (link valid 24h).
- **Roles & authorization:** `user` (default) and `admin`, enforced server-side.

#### FR-2 Profile & Settings

- **Editable:** alias, weight (+unit), fitness level, avatar (max 5MB jpeg/png/webp).
- **Immutable:** date of birth, gender (man, woman, diverse, prefer not to say).
- **Training frequency** stored for personalization.
- **Avatar:** 128Ã—128 preview, placeholder if absent.

#### FR-3 Exercise Library

- Create, edit, archive exercises with attributes (name, category: cardio/strength/power-endurance, muscle group, tags).
- **Default visibility:** private; public exercises discoverable.
- Safe delete = archive (hidden from selectors, retained for history).
- **Reuse across sessions:** snapshot of name retained in session_exercises for historical accuracy.

#### FR-4 Sessions

- **Plan sessions** for specific date/time or recurring template (time-zone aware, DST safe).
- **Log actuals**; mark completed/canceled; compare planned vs actual.
- **Clone & modify** own or public sessions (attribution retained).
- **Visibility:** private (default) or public; switching never leaks past data.
- **Archival:** sessions archived, not deleted, for historical traceability.

#### FR-5 Progress & Analytics

- **History view** with filters (date, category, visibility).
- **Charts**: volume, duration, distance, intensity, frequency.
- **Summaries**: weekly, monthly, yearly.
- **Personal bests & streaks** tracked.

#### FR-6 Points System

- Awarded server-side upon session completion.
- Formula inputs: calories (if available), age, gender, fitness level, frequency, RPE.
- **AC:** Users see awarded points only, not formula.
- Anti-gaming: bounds checking, device/IP heuristics; manual admin adjustments logged.

#### FR-7 Sharing & Community

- Authenticated feed of public sessions with search/sort.
- Clone public sessions into planner (attribution preserved).
- Reporting & moderation placeholders (future admin UI).
- **Policy:** default privacy is private; community guidelines apply.

#### FR-8 Internationalization (i18n)

- **Language Detection**: The system shall detect the user's preferred language via browser headers or stored profile preference.
- **Static UI Translation**: All visible system UI elements shall be translated using predefined token dictionaries (JSON resources).
- **Dynamic AI Translation**: User-generated text (e.g., session title, description, comments) shall be translated dynamically on request using an AI translation service.
- **Fallback**: If a translation for a token or text is unavailable, the system shall display the original English text.
- **Locale Formatting**: Dates, numbers, and units shall follow the selected locale conventions.
- **Caching**: The backend shall cache translated texts to reduce latency and API cost.
- **Privacy**: AI translation requests shall exclude personally identifiable information and respect GDPR principles.
- **User Preference Persistence**: The user's preferred language shall be stored in their profile and applied on login.

---

## 5. Non-Functional Requirements (NFR)

### 5.1 Security

**Authentication & Tokens**

- Passwords hashed with **bcryptjs** + per-user salts.
- JWT (**RS256**) short-lived access tokens (≤15 min).
- Server-stored **refresh tokens** with rotation (`jti`) and revocation on logout.

**Account Protection**

- **2FA** (TOTP + backup codes).
- Brute-force protection with exponential backoff;
- (Optional) **CAPTCHA** after repeated failures.
- Email verification mandatory;
- **unverified accounts purged after 7 days**.

**Transport & Session Security**

- **HTTPS only**; **TLS 1.3** with **OCSP stapling**;
- **HSTS** enabled at NGINX.
- `httpOnly`, `Secure`, `SameSite=Lax` cookies;
- **CSRF** protection for all state-changing requests.

**Security Headers**

- **Content-Security-Policy**: disallow `unsafe-inline`; restrict `script-src`, `img-src`, `connect-src` to allowlists.
- **Referrer-Policy: no-referrer**; **Permissions-Policy** hardened (camera/mic/geolocation denied by default).

**Secrets Management**

- Centralized secrets via **AWS Secrets Manager** or **HashiCorp Vault** with automated rotation and access audit trails.

**Rate Limiting / DoS**

- Application-level rate limits **and** reverse-proxy-level throttling via **NGINX**;
- **fail2ban** on suspicious IPs.

**File Upload Security**

- Mandatory **antivirus scanning** (e.g., ClamAV) for uploads;
- MIME/type & size validation; server-side image re-encoding.

**Audit & Anomaly Detection**

- **Security audit logging** for logins, 2FA events, password changes, deletions, admin actions.
- Automated **anomaly detection** (improbable IP/device changes) with user notifications and session hardening.

**Dependency & Supply-Chain Hygiene**

- CI includes **SCA** (npm audit, **Snyk**) and **secret scanning**;
- Vulnerable builds are blocked.

**Password Reset Flow**

- One-time reset tokens (≤ 15 min), **invalidated on first use**;
- Device fingerprint captured for risk signals.
- Successful resets **revoke all active sessions** and require re-login.

### 5.2 Privacy & GDPR

**Processing Register & Data Map**

- Maintain an Article 30 processing register;
- Document systems, processors, and data flows.

**Data Minimization & Pseudonymization**

- Separate PII from activity data;
- Minimize fields in logs/analytics;
- Prefer pseudonymous identifiers.

**Backups & Retention**

- Encrypted backups;
- **Deletion propagates within 14 days** (configurable).

**Consent Management**

- Cookie/consent manager in the frontend;
- Analytics and non-essential tracking only after **opt-in**.

**AI Translation Privacy**

- **PII redaction** middleware before external translation calls;
- Cache only **anonymized** texts.
- Support deletion of cached translations linked to user content (DSR).

**DSR Automation**

- Export (JSON) and deletion flows tracked end-to-end; issue deletion receipts in the audit log.

### 5.3 Performance

The system shall be designed to **sustain predictable performance under growth** through measurable KPIs, CI-enforced budgets, and architectural constraints.
See also §11.3.6 _Performance Governance_ for regression policy and enforcement.

#### 5.3.1 General Targets

| Metric                                 | Target (Nominal Load)                       | Definition / Notes                                    |
| -------------------------------------- | ------------------------------------------- | ----------------------------------------------------- |
| **Backend API latency (p95)**          | < **300 ms** overall                        | Measured at API gateway under 500 concurrent requests |
| **Frontend LCP**                       | < **2.5 s**                                 | Mid-tier device, 4G connection                        |
| **Frontend CLS**                       | < **0.1**                                   | Layout stability across devices                       |
| **Frontend TTI (Time-to-Interactive)** | < **3.0 s**                                 | Lazy loading required for all routes                  |
| **Error rate**                         | < **0.1 %** sustained                       | Calculated per release window                         |
| **Throughput**                         | ≥ **500 req/s sustained**, 1000 req/s burst | Validated in automated k6 tests                       |
| **Cold-start container boot**          | ≤ **5 s**                                   | Measured from container start leads to `/health` OK   |

Performance regressions **> 10 % from baseline block release** until mitigated.

---

#### 5.3.2 Per-Endpoint Budgets

| Endpoint Group                  | Target p95            | Expected Payload        | Notes                         |
| ------------------------------- | --------------------- | ----------------------- | ----------------------------- |
| **Auth / Users**                | ≤ 200 ms              | < 10 KB                 | Short transactions only       |
| **Exercises / Sessions (CRUD)** | ≤ 300 ms              | < 100 KB                | Cached lookups preferred      |
| **Progress / Analytics**        | ≤ 600 ms              | up to 250 KB            | Served via materialized views |
| **Feed / Public endpoints**     | ≤ 400 ms              | paginated 20 items/page | Edge-cached 30 s via NGINX    |
| **AI Translation**              | ≤ 800 ms (cache miss) | -                       | Async job if longer           |

---

#### 5.3.3 Frontend Budgets

| Component                | Target                            | Validation                       |
| ------------------------ | --------------------------------- | -------------------------------- |
| **Total JS bundle**      | ≤ 300 KB gz                       | Lighthouse CI budget             |
| **API calls / page**     | ≤ 5                               | UX validation                    |
| **Static asset caching** | `immutable, max-age=31536000`     | Enforced in NGINX                |
| **Critical CSS**         | inlined for initial route         | Build config                     |
| **Lazy loading**         | Mandatory for non-critical routes | React lazy + Vite code-splitting |

---

#### 5.3.4 Backend Constraints

- **Response size limit:** 1 MB max; larger payloads must paginate or stream.
- **Pagination:** default = 20 items, max = 100.
- **Compression:** Gzip/Brotli only for responses > 1 KB.
- **Timeouts:** Request timeout = 10 s; circuit breaker opens after 3 consecutive failures.
- **Caching:**
  - Read-through cache for heavy queries (feed, progress).
  - Redis TTL = 60 s (default) with explicit invalidation on data changes.

---

#### 5.3.5 Database Performance

- **Connection pooling:** via PgBouncer; p95 wait time < 5 ms.
- **Partitioning:** monthly partitions for high-volume tables (`sessions`, `user_points`).
- **Query optimization:**
  - `pg_stat_statements` and `auto_explain` enabled.
  - Slow-query threshold = 200 ms; alerts in Grafana.
- **Materialized view refresh:** asynchronous, non-blocking (`REFRESH CONCURRENTLY`) on `session.completed` or nightly.
- **Caching index:** Redis (or LRU fallback in dev) / PostgreSQL hash lookup for translation cache (O(1) hits).

---

#### 5.3.6 Testing & Validation

- Load tests (k6 / Artillery) executed in CI.
- Baseline dataset ≥ 10 000 sessions for realistic query cost.
- Lighthouse CI runs per PR for LCP / bundle budgets.
- Regression threshold: > 10 % deviation → pipeline fail.

Performance KPIs account for secure transport (TLS 1.3) and rate limiting overhead (~5 % latency buffer).

---

### 5.4 Availability

- Service Level Objective (SLO): **99.5% monthly availability**.
- API p95 budgets per endpoint family defined; alerting derived from these SLOs (thresholds in runbooks)
- Error budget tracked to inform release management and reliability improvements.
- Stateless API and containerized infra support horizontal scaling.

### 5.5 Accessibility

- Conforms to **WCAG 2.1 AA**.
- Keyboard navigation, ARIA labels, and color-blind safe palettes.
- Responsive, barrier-free design across devices.

### 5.6 Observability

- Structured, non-PII logs with correlation IDs.
- Dashboards for latency (p95), error rate, and auth failures.
- Alerts for 5xx spikes, DB pool saturation, and security anomalies.

See §6.10 for detailed metric definitions and alert thresholds.

#### 5.6.1 Additions for Performance Monitoring

- **Metrics coverage:**
  - `http_request_duration_ms` histogram per route
  - `db_query_duration_ms` histogram
  - `frontend_lcp_ms` gauge via RUM SDK
- **Alert thresholds:**
  - p95 latency > 400 ms for 10 min → warning
  - error rate > 0.5 % for 5 min → critical
- **Tracing sampling:**
  - 10 % of normal traffic, 100 % of 5xx responses.
- **Dashboards:** show API latency, DB wait, frontend LCP/FID, cache hit ratio.
- **Correlation:** FE → BE request IDs for tracing full transaction time.

### 5.7 Backup & Disaster Recovery (DR)

- **Retention:** deletion propagation window **14 days** (configurable).
- **DR Tests:** include **regional failover simulation**.
- Daily encrypted backups of all critical data.
- **Recovery Point Objective (RPO): ≤24h**.
- **Recovery Time Objective (RTO): ≤4h**.
- Quarterly restore tests ensure backup integrity.

### 5.8 Modularity & Extensibility

- Strict separation of concerns (frontend, backend, infra).
- API-first design with versioning (`/api/v1`).
- Extensible architecture to support nutrition, wearables, AI coaching, and leaderboards.

### 5.9 Security Threat Model

The system shall follow a structured threat-mitigation model aligned with OWASP Top 10 (2021).
Each vector is mitigated through preventive and detective controls at application, infrastructure, and process level.

| ID  | Threat / Attack Vector            | Risk Description                                                                  | Mitigation                                                                                                                       | OWASP Top 10 Ref                                               |
| --- | --------------------------------- | --------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------- |
| R1  | Brute-force login attempts        | Automated password guessing against login endpoint.                               | - **Rate limiting** per IP & account.<br>- Optional CAPTCHA after repeated failures.<br>- Strong password policy.                | A07: Identification & Authentication Failures                  |
| R2  | Password theft / hash cracking    | Stolen DB dump used to brute-force weak hashes offline.                           | - **bcryptjs** with per-user salt.<br>- Enforce password complexity.<br>- Credential rotation policy.                            | A02: Cryptographic Failures                                    |
| R3  | Token theft (XSS / localStorage)  | Stolen JWT access/refresh tokens misused for API access.                          | - Store tokens in **httpOnly Secure cookies**.<br>- Short-lived access tokens (≤15 min).<br>- Refresh token rotation with `jti`. | A07: Identification & Authentication Failures / A03: Injection |
| R4  | Refresh token replay              | Attacker reuses stolen refresh token to obtain new access tokens.                 | - **Refresh token rotation** (rotate on every use).<br>- Server-stored tokens with `jti`.<br>- Revoke on anomaly/logout.         | A07: Identification & Authentication Failures                  |
| R5  | Cross-Site Request Forgery (CSRF) | Unauthorized state-changing requests executed via victim's authenticated session. | - **SameSite=Lax cookies**.<br>- CSRF protection middleware.<br>- Validate `Origin`/`Referer` headers.                           | A05: Security Misconfiguration / A08: CSRF                     |
| R6  | Cross-Site Scripting (XSS)        | Injected JS steals cookies or manipulates DOM.                                    | - **httpOnly cookies**.<br>- **CSP headers**.<br>- React DOM sanitization.<br>- Input validation.                                | A03: Injection                                                 |
| R7  | Session fixation                  | Attacker forces victim to use a known session token.                              | - **Refresh tokens rotated** at login.<br>- Invalidate sessions on password change or logout.                                    | A07: Identification & Authentication Failures                  |
| R8  | Man-in-the-Middle (MITM)          | Network interception of credentials or tokens.                                    | - **HTTPS only** via NGINX.<br>- TLS 1.2+ enforced.<br>- **HSTS** headers enabled.                                               | A02: Cryptographic Failures                                    |
| R9  | Account takeover via reset        | Weak password reset exploited to gain control of accounts.                        | - **One-time reset tokens** (expire ≤15 min).<br>- Verified email links.<br>- Reset invalidates sessions.                        | A07: Identification & Authentication Failures                  |
| R10 | Privilege escalation              | Attacker bypasses or manipulates role checks.                                     | - **RBAC enforced server-side**.<br>- Minimal JWT claims.<br>- Backend validates roles, not client.                              | A01: Broken Access Control                                     |
| R11 | Data leakage via logs             | Sensitive data (tokens, passwords, PII) written to logs.                          | - **Structured logging** (pino/winston).<br>- Exclude PII.<br>- Use correlation IDs only.                                        | A09: Security Logging & Monitoring Failures                    |
| R12 | Denial of Service (DoS)           | Flood of requests exhausts server or DB resources.                                | - **Rate limiting**.<br>- Optional **Redis counters** (future scaling).<br>- Autoscaling (future).                               | A06: Vulnerable & Outdated Components / A08: DoS               |
| R13 | Supply chain vulnerabilities      | Dependencies or base images compromised                                           | - **npm audit**, **Snyk**, **Trivy** in CI;<br>- signed images (sha256)                                                          | A06: Vulnerable & Outdated Components                          |

---

## 6. Technology (moved)

This section has been migrated to the **Technical Design Document (TDD)**.
See **TDD → Platform & Stack, API Design, Security/Privacy, Observability, i18n**.
